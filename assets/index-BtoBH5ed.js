var I=Object.defineProperty;var L=(a,t,s)=>t in a?I(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var o=(a,t,s)=>L(a,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();function l(a,t){return{x:a.x+t.x,y:a.y+t.y}}function d(a,t){return{x:a.x*t,y:a.y*t}}function V(a){return Math.sqrt(a.x*a.x+a.y*a.y)}function u(a,t){const s=Math.cos(t),e=Math.sin(t);return{x:a.x*s-a.y*e,y:a.x*e+a.y*s}}function B(a,t){const s=t.x-a.x,e=t.y-a.y;return Math.sqrt(s*s+e*e)}function c(a,t){return a+Math.random()*(t-a)}function G(a,t){return Math.floor(c(a,t+1))}function g(a){return{x:Math.sin(a),y:-Math.cos(a)}}const k={A:[[{x:0,y:7},{x:0,y:2}],[{x:0,y:2},{x:2.5,y:0}],[{x:2.5,y:0},{x:5,y:2}],[{x:5,y:2},{x:5,y:7}],[{x:0,y:4},{x:5,y:4}]],B:[[{x:0,y:0},{x:0,y:7}],[{x:0,y:0},{x:4,y:0}],[{x:4,y:0},{x:5,y:1}],[{x:5,y:1},{x:5,y:2.5}],[{x:5,y:2.5},{x:4,y:3.5}],[{x:4,y:3.5},{x:0,y:3.5}],[{x:4,y:3.5},{x:5,y:4.5}],[{x:5,y:4.5},{x:5,y:6}],[{x:5,y:6},{x:4,y:7}],[{x:4,y:7},{x:0,y:7}]],C:[[{x:5,y:1},{x:4,y:0}],[{x:4,y:0},{x:1,y:0}],[{x:1,y:0},{x:0,y:1}],[{x:0,y:1},{x:0,y:6}],[{x:0,y:6},{x:1,y:7}],[{x:1,y:7},{x:4,y:7}],[{x:4,y:7},{x:5,y:6}]],D:[[{x:0,y:0},{x:0,y:7}],[{x:0,y:0},{x:3,y:0}],[{x:3,y:0},{x:5,y:2}],[{x:5,y:2},{x:5,y:5}],[{x:5,y:5},{x:3,y:7}],[{x:3,y:7},{x:0,y:7}]],E:[[{x:5,y:0},{x:0,y:0}],[{x:0,y:0},{x:0,y:7}],[{x:0,y:7},{x:5,y:7}],[{x:0,y:3.5},{x:4,y:3.5}]],F:[[{x:5,y:0},{x:0,y:0}],[{x:0,y:0},{x:0,y:7}],[{x:0,y:3.5},{x:4,y:3.5}]],G:[[{x:5,y:1},{x:4,y:0}],[{x:4,y:0},{x:1,y:0}],[{x:1,y:0},{x:0,y:1}],[{x:0,y:1},{x:0,y:6}],[{x:0,y:6},{x:1,y:7}],[{x:1,y:7},{x:4,y:7}],[{x:4,y:7},{x:5,y:6}],[{x:5,y:6},{x:5,y:4}],[{x:5,y:4},{x:3,y:4}]],H:[[{x:0,y:0},{x:0,y:7}],[{x:5,y:0},{x:5,y:7}],[{x:0,y:3.5},{x:5,y:3.5}]],I:[[{x:1,y:0},{x:4,y:0}],[{x:2.5,y:0},{x:2.5,y:7}],[{x:1,y:7},{x:4,y:7}]],J:[[{x:1,y:0},{x:5,y:0}],[{x:3.5,y:0},{x:3.5,y:6}],[{x:3.5,y:6},{x:2.5,y:7}],[{x:2.5,y:7},{x:1,y:7}],[{x:1,y:7},{x:0,y:6}]],K:[[{x:0,y:0},{x:0,y:7}],[{x:5,y:0},{x:0,y:3.5}],[{x:0,y:3.5},{x:5,y:7}]],L:[[{x:0,y:0},{x:0,y:7}],[{x:0,y:7},{x:5,y:7}]],M:[[{x:0,y:7},{x:0,y:0}],[{x:0,y:0},{x:2.5,y:4}],[{x:2.5,y:4},{x:5,y:0}],[{x:5,y:0},{x:5,y:7}]],N:[[{x:0,y:7},{x:0,y:0}],[{x:0,y:0},{x:5,y:7}],[{x:5,y:7},{x:5,y:0}]],O:[[{x:1,y:0},{x:4,y:0}],[{x:4,y:0},{x:5,y:1}],[{x:5,y:1},{x:5,y:6}],[{x:5,y:6},{x:4,y:7}],[{x:4,y:7},{x:1,y:7}],[{x:1,y:7},{x:0,y:6}],[{x:0,y:6},{x:0,y:1}],[{x:0,y:1},{x:1,y:0}]],P:[[{x:0,y:7},{x:0,y:0}],[{x:0,y:0},{x:4,y:0}],[{x:4,y:0},{x:5,y:1}],[{x:5,y:1},{x:5,y:3}],[{x:5,y:3},{x:4,y:4}],[{x:4,y:4},{x:0,y:4}]],Q:[[{x:1,y:0},{x:4,y:0}],[{x:4,y:0},{x:5,y:1}],[{x:5,y:1},{x:5,y:5}],[{x:5,y:5},{x:4,y:6}],[{x:4,y:6},{x:5,y:7}],[{x:4,y:6},{x:1,y:6}],[{x:1,y:6},{x:0,y:5}],[{x:0,y:5},{x:0,y:1}],[{x:0,y:1},{x:1,y:0}],[{x:3,y:5},{x:5,y:7}]],R:[[{x:0,y:7},{x:0,y:0}],[{x:0,y:0},{x:4,y:0}],[{x:4,y:0},{x:5,y:1}],[{x:5,y:1},{x:5,y:3}],[{x:5,y:3},{x:4,y:4}],[{x:4,y:4},{x:0,y:4}],[{x:2,y:4},{x:5,y:7}]],S:[[{x:5,y:1},{x:4,y:0}],[{x:4,y:0},{x:1,y:0}],[{x:1,y:0},{x:0,y:1}],[{x:0,y:1},{x:0,y:2.5}],[{x:0,y:2.5},{x:1,y:3.5}],[{x:1,y:3.5},{x:4,y:3.5}],[{x:4,y:3.5},{x:5,y:4.5}],[{x:5,y:4.5},{x:5,y:6}],[{x:5,y:6},{x:4,y:7}],[{x:4,y:7},{x:1,y:7}],[{x:1,y:7},{x:0,y:6}]],T:[[{x:0,y:0},{x:5,y:0}],[{x:2.5,y:0},{x:2.5,y:7}]],U:[[{x:0,y:0},{x:0,y:6}],[{x:0,y:6},{x:1,y:7}],[{x:1,y:7},{x:4,y:7}],[{x:4,y:7},{x:5,y:6}],[{x:5,y:6},{x:5,y:0}]],V:[[{x:0,y:0},{x:2.5,y:7}],[{x:2.5,y:7},{x:5,y:0}]],W:[[{x:0,y:0},{x:1,y:7}],[{x:1,y:7},{x:2.5,y:4}],[{x:2.5,y:4},{x:4,y:7}],[{x:4,y:7},{x:5,y:0}]],X:[[{x:0,y:0},{x:5,y:7}],[{x:5,y:0},{x:0,y:7}]],Y:[[{x:0,y:0},{x:2.5,y:3.5}],[{x:5,y:0},{x:2.5,y:3.5}],[{x:2.5,y:3.5},{x:2.5,y:7}]],Z:[[{x:0,y:0},{x:5,y:0}],[{x:5,y:0},{x:0,y:7}],[{x:0,y:7},{x:5,y:7}]],0:[[{x:1,y:0},{x:4,y:0}],[{x:4,y:0},{x:5,y:1}],[{x:5,y:1},{x:5,y:6}],[{x:5,y:6},{x:4,y:7}],[{x:4,y:7},{x:1,y:7}],[{x:1,y:7},{x:0,y:6}],[{x:0,y:6},{x:0,y:1}],[{x:0,y:1},{x:1,y:0}],[{x:0,y:6},{x:5,y:1}]],1:[[{x:1,y:1},{x:2.5,y:0}],[{x:2.5,y:0},{x:2.5,y:7}],[{x:1,y:7},{x:4,y:7}]],2:[[{x:0,y:1},{x:1,y:0}],[{x:1,y:0},{x:4,y:0}],[{x:4,y:0},{x:5,y:1}],[{x:5,y:1},{x:5,y:2.5}],[{x:5,y:2.5},{x:0,y:7}],[{x:0,y:7},{x:5,y:7}]],3:[[{x:0,y:1},{x:1,y:0}],[{x:1,y:0},{x:4,y:0}],[{x:4,y:0},{x:5,y:1}],[{x:5,y:1},{x:5,y:2.5}],[{x:5,y:2.5},{x:4,y:3.5}],[{x:4,y:3.5},{x:2,y:3.5}],[{x:4,y:3.5},{x:5,y:4.5}],[{x:5,y:4.5},{x:5,y:6}],[{x:5,y:6},{x:4,y:7}],[{x:4,y:7},{x:1,y:7}],[{x:1,y:7},{x:0,y:6}]],4:[[{x:4,y:7},{x:4,y:0}],[{x:4,y:0},{x:0,y:5}],[{x:0,y:5},{x:5,y:5}]],5:[[{x:5,y:0},{x:0,y:0}],[{x:0,y:0},{x:0,y:3}],[{x:0,y:3},{x:4,y:3}],[{x:4,y:3},{x:5,y:4}],[{x:5,y:4},{x:5,y:6}],[{x:5,y:6},{x:4,y:7}],[{x:4,y:7},{x:1,y:7}],[{x:1,y:7},{x:0,y:6}]],6:[[{x:4,y:0},{x:1,y:0}],[{x:1,y:0},{x:0,y:1}],[{x:0,y:1},{x:0,y:6}],[{x:0,y:6},{x:1,y:7}],[{x:1,y:7},{x:4,y:7}],[{x:4,y:7},{x:5,y:6}],[{x:5,y:6},{x:5,y:4.5}],[{x:5,y:4.5},{x:4,y:3.5}],[{x:4,y:3.5},{x:0,y:3.5}]],7:[[{x:0,y:0},{x:5,y:0}],[{x:5,y:0},{x:2,y:7}]],8:[[{x:1,y:0},{x:4,y:0}],[{x:4,y:0},{x:5,y:1}],[{x:5,y:1},{x:5,y:2.5}],[{x:5,y:2.5},{x:4,y:3.5}],[{x:4,y:3.5},{x:1,y:3.5}],[{x:1,y:3.5},{x:0,y:2.5}],[{x:0,y:2.5},{x:0,y:1}],[{x:0,y:1},{x:1,y:0}],[{x:4,y:3.5},{x:5,y:4.5}],[{x:5,y:4.5},{x:5,y:6}],[{x:5,y:6},{x:4,y:7}],[{x:4,y:7},{x:1,y:7}],[{x:1,y:7},{x:0,y:6}],[{x:0,y:6},{x:0,y:4.5}],[{x:0,y:4.5},{x:1,y:3.5}]],9:[[{x:1,y:7},{x:4,y:7}],[{x:4,y:7},{x:5,y:6}],[{x:5,y:6},{x:5,y:1}],[{x:5,y:1},{x:4,y:0}],[{x:4,y:0},{x:1,y:0}],[{x:1,y:0},{x:0,y:1}],[{x:0,y:1},{x:0,y:2.5}],[{x:0,y:2.5},{x:1,y:3.5}],[{x:1,y:3.5},{x:5,y:3.5}]],":":[[{x:2.5,y:2},{x:2.5,y:2.5}],[{x:2.5,y:5},{x:2.5,y:5.5}]]," ":[]},R=5,T=1.5;function D(a,t,s,e){const i=[],r=a.toUpperCase();let n=t;for(const h of r){const y=k[h];if(y)for(const x of y)i.push({start:{x:n+x[0].x*e,y:s+x[0].y*e},end:{x:n+x[1].x*e,y:s+x[1].y*e}});n+=(R+T)*e}return i}function W(a,t){return a.length*(R+T)*t-T*t}class N{constructor(t){o(this,"ctx");o(this,"width");o(this,"height");o(this,"glowEnabled",!0);o(this,"glowIntensity",1);o(this,"lineBatches",new Map);o(this,"pointBatches",new Map);const s=t.getContext("2d");if(!s)throw new Error("Could not get 2D context from canvas");this.ctx=s,this.width=800,this.height=600,t.width=this.width,t.height=this.height}clear(){this.ctx.globalAlpha=1,this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalAlpha=1,this.lineBatches.clear(),this.pointBatches.clear()}drawShape(t,s,e="#0ff",i=2){if(t.length<2)return;const{position:r,rotation:n,scale:h}=s,y=t.map(x=>{const f={x:x.x*h,y:x.y*h},C=u(f,n);return l(C,r)});for(let x=0;x<y.length;x++){const f=(x+1)%y.length;this.addLineToBatch(y[x],y[f],e,i,1)}}drawLine(t,s,e="#0ff",i=2,r=1){this.addLineToBatch(t,s,e,i,r)}drawPoint(t,s=3,e="#0ff"){const i=`${e}-${s}`;let r=this.pointBatches.get(i);r||(r={points:[],color:e,radius:s},this.pointBatches.set(i,r)),r.points.push({pos:t,alpha:1})}drawText(t,s,e,i=3,r="#0ff"){const n=W(t,i),h=s-n/2,y=D(t,h,e,i),x=Math.max(1,i*.4);for(const f of y)this.addLineToBatch(f.start,f.end,r,x,1)}addLineToBatch(t,s,e,i,r){const n=`${e}-${i}`;let h=this.lineBatches.get(n);h||(h={segments:[],color:e,lineWidth:i},this.lineBatches.set(n,h)),h.segments.push({start:t,end:s,alpha:r})}flush(){for(const t of this.lineBatches.values())this.renderLineBatch(t);for(const t of this.pointBatches.values())this.renderPointBatch(t)}renderLineBatch(t){const{segments:s,color:e,lineWidth:i}=t;if(s.length===0)return;if(s.every(n=>n.alpha===s[0].alpha)){if(this.ctx.globalAlpha=s[0].alpha,this.ctx.strokeStyle=e,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.glowEnabled){this.ctx.lineWidth=i+1,this.ctx.shadowColor=e,this.ctx.shadowBlur=this.glowIntensity,this.ctx.beginPath();for(const n of s)this.ctx.moveTo(n.start.x,n.start.y),this.ctx.lineTo(n.end.x,n.end.y);this.ctx.stroke()}this.ctx.shadowBlur=0,this.ctx.lineWidth=i,this.ctx.beginPath();for(const n of s)this.ctx.moveTo(n.start.x,n.start.y),this.ctx.lineTo(n.end.x,n.end.y);this.ctx.stroke(),this.ctx.globalAlpha=1}else{this.ctx.strokeStyle=e,this.ctx.lineCap="round",this.ctx.lineJoin="round";for(const n of s)this.ctx.globalAlpha=n.alpha,this.glowEnabled&&(this.ctx.lineWidth=i+1,this.ctx.shadowColor=e,this.ctx.shadowBlur=this.glowIntensity,this.ctx.beginPath(),this.ctx.moveTo(n.start.x,n.start.y),this.ctx.lineTo(n.end.x,n.end.y),this.ctx.stroke()),this.ctx.shadowBlur=0,this.ctx.lineWidth=i,this.ctx.beginPath(),this.ctx.moveTo(n.start.x,n.start.y),this.ctx.lineTo(n.end.x,n.end.y),this.ctx.stroke();this.ctx.globalAlpha=1}}renderPointBatch(t){const{points:s,color:e,radius:i}=t;if(s.length!==0){if(this.glowEnabled){this.ctx.fillStyle=e,this.ctx.shadowColor=e,this.ctx.shadowBlur=this.glowIntensity,this.ctx.beginPath();for(const r of s)this.ctx.moveTo(r.pos.x+i,r.pos.y),this.ctx.arc(r.pos.x,r.pos.y,i,0,Math.PI*2);this.ctx.fill()}this.ctx.shadowBlur=0,this.ctx.fillStyle=this.glowEnabled?"#fff":e,this.ctx.beginPath();for(const r of s){const n=this.glowEnabled?i*.5:i;this.ctx.moveTo(r.pos.x+n,r.pos.y),this.ctx.arc(r.pos.x,r.pos.y,n,0,Math.PI*2)}this.ctx.fill()}}}class q{constructor(){o(this,"keys",{left:!1,right:!1,thrust:!1,fire:!1});o(this,"firePressed",!1);o(this,"startPressed",!1);o(this,"spaceWasReleased",!0);o(this,"glowTogglePressed",!1);window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this))}handleKeyDown(t){this.updateKey(t.code,!0),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space"].includes(t.code)&&t.preventDefault()}handleKeyUp(t){this.updateKey(t.code,!1)}updateKey(t,s){switch(t){case"ArrowLeft":case"KeyA":this.keys.left=s;break;case"ArrowRight":case"KeyD":this.keys.right=s;break;case"ArrowUp":case"KeyW":this.keys.thrust=s;break;case"Space":this.keys.fire=s,s?(this.firePressed=!0,this.spaceWasReleased&&(this.startPressed=!0,this.spaceWasReleased=!1)):this.spaceWasReleased=!0;break;case"KeyG":s&&(this.glowTogglePressed=!0);break}}getKeys(){return{...this.keys}}consumeFirePress(){return this.firePressed?(this.firePressed=!1,!0):!1}consumeStartPress(){return this.startPressed?(this.startPressed=!1,!0):!1}consumeGlowTogglePress(){return this.glowTogglePressed?(this.glowTogglePressed=!1,!0):!1}}class F{constructor(){o(this,"ctx",null);o(this,"initialized",!1)}ensureContext(){if(!this.initialized)try{this.ctx=new AudioContext,this.initialized=!0}catch{this.initialized=!0}return this.ctx}playShoot(){const t=this.ensureContext();if(!t)return;const s=t.createOscillator(),e=t.createGain();s.connect(e),e.connect(t.destination),s.type="square",s.frequency.setValueAtTime(880,t.currentTime),s.frequency.exponentialRampToValueAtTime(110,t.currentTime+.1),e.gain.setValueAtTime(.3,t.currentTime),e.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),s.start(t.currentTime),s.stop(t.currentTime+.1)}playExplosion(t){const s=this.ensureContext();if(!s)return;const e=t==="large"?.4:t==="medium"?.25:.15,i=t==="large"?100:t==="medium"?150:200,r=s.createOscillator(),n=s.createGain();r.connect(n),n.connect(s.destination),r.type="sawtooth",r.frequency.setValueAtTime(i,s.currentTime),r.frequency.exponentialRampToValueAtTime(20,s.currentTime+e),n.gain.setValueAtTime(.4,s.currentTime),n.gain.exponentialRampToValueAtTime(.01,s.currentTime+e),r.start(s.currentTime),r.stop(s.currentTime+e)}playThrust(){const t=this.ensureContext();if(!t)return;const s=t.sampleRate*.05,e=t.createBuffer(1,s,t.sampleRate),i=e.getChannelData(0);for(let y=0;y<s;y++)i[y]=Math.random()*2-1;const r=t.createBufferSource(),n=t.createGain(),h=t.createBiquadFilter();r.buffer=e,h.type="lowpass",h.frequency.value=1e3,r.connect(h),h.connect(n),n.connect(t.destination),n.gain.setValueAtTime(.1,t.currentTime),n.gain.exponentialRampToValueAtTime(.01,t.currentTime+.05),r.start(t.currentTime)}playDeath(){const t=this.ensureContext();if(!t)return;const s=t.createOscillator(),e=t.createGain();s.connect(e),e.connect(t.destination),s.type="sawtooth",s.frequency.setValueAtTime(440,t.currentTime),s.frequency.exponentialRampToValueAtTime(55,t.currentTime+.8),e.gain.setValueAtTime(.4,t.currentTime),e.gain.exponentialRampToValueAtTime(.01,t.currentTime+.8),s.start(t.currentTime),s.stop(t.currentTime+.8)}playLevelUp(){const t=this.ensureContext();if(!t)return;[262,330,392,523].forEach((e,i)=>{const r=t.createOscillator(),n=t.createGain();r.connect(n),n.connect(t.destination),r.type="square",r.frequency.value=e;const h=t.currentTime+i*.1;n.gain.setValueAtTime(0,h),n.gain.linearRampToValueAtTime(.2,h+.02),n.gain.exponentialRampToValueAtTime(.01,h+.15),r.start(h),r.stop(h+.15)})}}const U=[{x:0,y:-15},{x:10,y:12},{x:0,y:6},{x:-10,y:12}],w=[[{x:-4,y:8},{x:0,y:16},{x:4,y:8}],[{x:-5,y:8},{x:-2,y:14},{x:0,y:22},{x:2,y:14},{x:5,y:8}],[{x:-5,y:8},{x:-3,y:18},{x:0,y:26},{x:3,y:18},{x:5,y:8}]],A=5,H=200,v=400;class K{constructor(t,s){o(this,"transform",{position:{x:0,y:0},rotation:0,scale:1});o(this,"velocity",{x:0,y:0});o(this,"angularVelocity",0);o(this,"shape",U);o(this,"radius",12);o(this,"isActive",!0);o(this,"isThrusting",!1);o(this,"invulnerableTime",0);this.transform.position={x:t,y:s}}reset(t,s){this.transform.position={x:t,y:s},this.transform.rotation=0,this.velocity={x:0,y:0},this.isActive=!0,this.invulnerableTime=3}rotateLeft(t){this.transform.rotation-=A*t}rotateRight(t){this.transform.rotation+=A*t}thrust(t){this.isThrusting=!0;const s=g(this.transform.rotation),e=d(s,H*t);this.velocity=l(this.velocity,e);const i=V(this.velocity);i>v&&(this.velocity=d(this.velocity,v/i))}update(t){this.transform.position=l(this.transform.position,d(this.velocity,t)),this.invulnerableTime>0&&(this.invulnerableTime-=t)}getNosePosition(){const t=g(this.transform.rotation);return l(this.transform.position,d(t,15))}isInvulnerable(){return this.invulnerableTime>0}}const M={large:{radius:40,minVerts:10,maxVerts:14,speed:50,points:20},medium:{radius:20,minVerts:8,maxVerts:10,speed:80,points:50},small:{radius:10,minVerts:6,maxVerts:8,speed:120,points:100}};function _(a){const t=M[a],s=G(t.minVerts,t.maxVerts),e=[];for(let i=0;i<s;i++){const r=i/s*Math.PI*2,n=t.radius*c(.7,1);e.push({x:Math.cos(r)*n,y:Math.sin(r)*n})}return e}class p{constructor(t,s,e,i){o(this,"transform",{position:{x:0,y:0},rotation:0,scale:1});o(this,"velocity",{x:0,y:0});o(this,"angularVelocity");o(this,"shape");o(this,"radius");o(this,"isActive",!0);o(this,"size");o(this,"points");this.size=e;const r=M[e];if(this.transform.position={x:t,y:s},this.shape=_(e),this.radius=r.radius,this.points=r.points,this.angularVelocity=c(-2,2),i)this.velocity=d(i,r.speed);else{const n=c(0,Math.PI*2);this.velocity={x:Math.cos(n)*r.speed,y:Math.sin(n)*r.speed}}}update(t){this.transform.position=l(this.transform.position,d(this.velocity,t)),this.transform.rotation+=this.angularVelocity*t}split(){if(this.size==="small")return[];const t=this.size==="large"?"medium":"small",{x:s,y:e}=this.transform.position,i=c(0,Math.PI*2),r=i+Math.PI/2+c(-.5,.5);return[new p(s,e,t,{x:Math.cos(i),y:Math.sin(i)}),new p(s,e,t,{x:Math.cos(r),y:Math.sin(r)})]}}const $=500,z=1.5;class X{constructor(t,s,e){o(this,"transform",{position:{x:0,y:0},rotation:0,scale:1});o(this,"velocity");o(this,"angularVelocity",0);o(this,"shape",[]);o(this,"radius",2);o(this,"isActive",!0);o(this,"lifetime");this.transform.position={x:t,y:s},this.velocity=d(e,$),this.lifetime=z}update(t){this.transform.position=l(this.transform.position,d(this.velocity,t)),this.lifetime-=t,this.lifetime<=0&&(this.isActive=!1)}}const b=2,E=80;class J{constructor(t,s,e){o(this,"lines",[]);o(this,"isActive",!0);for(let i=0;i<e.length;i++){const r=(i+1)%e.length,n=u(e[i],s),h=u(e[r],s),y=c(0,Math.PI*2),x=c(E*.5,E);this.lines.push({start:l(t,n),end:l(t,h),velocity:{x:Math.cos(y)*x,y:Math.sin(y)*x},angularVelocity:c(-3,3),rotation:0,lifetime:b,maxLifetime:b})}}update(t){let s=!1;for(const e of this.lines){if(e.lifetime<=0)continue;const i=d(e.velocity,t);e.start=l(e.start,i),e.end=l(e.end,i),e.rotation+=e.angularVelocity*t;const r={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2},n={x:(e.end.x-e.start.x)/2,y:(e.end.y-e.start.y)/2},h=u(n,e.angularVelocity*t);e.start={x:r.x-h.x,y:r.y-h.y},e.end={x:r.x+h.x,y:r.y+h.y},e.lifetime-=t,e.lifetime>0&&(s=!0)}this.isActive=s}getAlpha(t){return t.lifetime<t.maxLifetime/2?t.lifetime/(t.maxLifetime/2):1}}function P(a,t){return!a.isActive||!t.isActive?!1:B(a.transform.position,t.transform.position)<a.radius+t.radius}function m(a,t,s){const e=a.transform.position,i=a.radius;e.x<-i?e.x=t+i:e.x>t+i&&(e.x=-i),e.y<-i?e.y=s+i:e.y>s+i&&(e.y=-i)}const Y=.25,S=4;class Z{constructor(t){o(this,"renderer");o(this,"input");o(this,"audio");o(this,"ship");o(this,"asteroids",[]);o(this,"bullets",[]);o(this,"debris",[]);o(this,"data",{score:0,lives:3,level:1,state:"start"});o(this,"fireCooldown",0);o(this,"lastTime",0);o(this,"respawnTimer",0);o(this,"gameOverTimer",0);o(this,"frameCount",0);o(this,"fpsTime",0);o(this,"fpsEl");this.renderer=new N(t),this.input=new q,this.audio=new F,this.ship=new K(this.renderer.width/2,this.renderer.height/2),this.fpsEl=document.getElementById("fps-counter")}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this))}loop(t){const s=Math.min((t-this.lastTime)/1e3,.1);this.lastTime=t,this.frameCount++,this.fpsTime+=s,this.fpsTime>=1&&(this.fpsEl.textContent=`FPS: ${this.frameCount}`,this.frameCount=0,this.fpsTime=0),this.update(s),this.render(),requestAnimationFrame(this.loop.bind(this))}update(t){if(this.input.consumeGlowTogglePress()&&(this.renderer.glowEnabled=!this.renderer.glowEnabled),this.data.state==="start"){this.input.consumeStartPress()&&this.startGame();return}if(this.data.state==="gameOver"){if(this.gameOverTimer-=t,this.gameOverTimer<=0){this.resetGame();return}this.input.consumeStartPress()&&(this.resetGame(),this.startGame());return}this.respawnTimer>0&&(this.respawnTimer-=t,this.respawnTimer<=0&&this.ship.reset(this.renderer.width/2,this.renderer.height/2)),this.fireCooldown>0&&(this.fireCooldown-=t);const s=this.input.getKeys();this.ship.isThrusting=!1,this.ship.isActive&&(s.left&&this.ship.rotateLeft(t),s.right&&this.ship.rotateRight(t),s.thrust&&(this.ship.thrust(t),this.audio.playThrust()),this.input.consumeFirePress()&&this.fireCooldown<=0&&this.fire()),this.ship.update(t),m(this.ship,this.renderer.width,this.renderer.height);for(const e of this.asteroids)e.update(t),m(e,this.renderer.width,this.renderer.height);for(const e of this.bullets)e.update(t),m(e,this.renderer.width,this.renderer.height);for(const e of this.debris)e.update(t);this.debris=this.debris.filter(e=>e.isActive),this.bullets=this.bullets.filter(e=>e.isActive),this.checkBulletCollisions(),this.checkShipCollision(),this.asteroids.length===0&&this.nextLevel()}fire(){const t=this.ship.getNosePosition(),s=g(this.ship.transform.rotation);this.bullets.push(new X(t.x,t.y,s)),this.fireCooldown=Y,this.audio.playShoot()}checkBulletCollisions(){const t=[];for(const s of this.bullets)for(const e of this.asteroids)if(P(s,e)){s.isActive=!1,e.isActive=!1,this.data.score+=e.points,this.audio.playExplosion(e.size),t.push(...e.split());break}this.asteroids=this.asteroids.filter(s=>s.isActive),this.asteroids.push(...t)}checkShipCollision(){if(!(!this.ship.isActive||this.ship.isInvulnerable())){for(const t of this.asteroids)if(P(this.ship,t)){this.shipDestroyed();break}}}shipDestroyed(){this.debris.push(new J(this.ship.transform.position,this.ship.transform.rotation,this.ship.shape)),this.ship.isActive=!1,this.data.lives--,this.audio.playDeath(),this.data.lives<=0?(this.data.state="gameOver",this.gameOverTimer=10):this.respawnTimer=2}nextLevel(){this.data.level++,this.audio.playLevelUp();const t=S+this.data.level-1;this.spawnAsteroids(t)}spawnAsteroids(t){for(let s=0;s<t;s++){let e,i;do e=c(0,this.renderer.width),i=c(0,this.renderer.height);while(Math.abs(e-this.ship.transform.position.x)<100&&Math.abs(i-this.ship.transform.position.y)<100);this.asteroids.push(new p(e,i,"large"))}}startGame(){this.data.state="playing",this.spawnAsteroids(S)}resetGame(){this.data={score:0,lives:3,level:1,state:"start"},this.asteroids=[],this.bullets=[],this.debris=[],this.ship.reset(this.renderer.width/2,this.renderer.height/2),this.respawnTimer=0}drawHUD(){this.renderer.drawText(`SCORE: ${this.data.score}`,100,25,2,"#0ff"),this.renderer.drawText(`LIVES: ${this.data.lives}`,this.renderer.width/2,25,2,"#0ff"),this.renderer.drawText(`LEVEL: ${this.data.level}`,this.renderer.width-100,25,2,"#0ff");const t=this.renderer.glowEnabled?"ON":"OFF";this.renderer.drawText(`G: GLOW ${t}`,this.renderer.width-80,this.renderer.height-20,1.5,this.renderer.glowEnabled?"#0f0":"#666")}render(){if(this.renderer.clear(),this.data.state==="start"){this.renderer.drawText("BATTLEOIDS",this.renderer.width/2,this.renderer.height/2-80,6),this.renderer.drawText("PRESS SPACE TO START",this.renderer.width/2,this.renderer.height/2,3,"#0ff"),this.renderer.drawText("ARROWS OR WASD TO MOVE",this.renderer.width/2,this.renderer.height/2+60,2,"#f0f"),this.renderer.drawText("SPACE TO SHOOT",this.renderer.width/2,this.renderer.height/2+90,2,"#f0f"),this.renderer.flush();return}for(const t of this.asteroids)this.renderer.drawShape(t.shape,t.transform,"#f0f");for(const t of this.bullets)this.renderer.drawPoint(t.transform.position,3,"#ff0");for(const t of this.debris)for(const s of t.lines)if(s.lifetime>0){const e=t.getAlpha(s);this.renderer.drawLine(s.start,s.end,"#0ff",2,e)}if(this.ship.isActive&&(!this.ship.isInvulnerable()||Math.floor(Date.now()/100)%2===0)&&(this.renderer.drawShape(this.ship.shape,this.ship.transform,"#0ff"),this.ship.isThrusting)){const s=Math.floor(Math.random()*w.length);this.renderer.drawShape(w[s],this.ship.transform,"#f80")}if(this.data.state==="gameOver"){this.renderer.drawText("GAME OVER",this.renderer.width/2,this.renderer.height/2-40,5),this.renderer.drawText(`FINAL SCORE: ${this.data.score}`,this.renderer.width/2,this.renderer.height/2+20,3),this.renderer.drawText("PRESS SPACE TO PLAY AGAIN",this.renderer.width/2,this.renderer.height/2+70,2,"#f0f");const t=Math.ceil(this.gameOverTimer);this.renderer.drawText(`RETURNING TO MENU IN ${t}`,this.renderer.width/2,this.renderer.height/2+110,2,"#666")}(this.data.state==="playing"||this.data.state==="gameOver")&&this.drawHUD(),this.renderer.flush()}}const O=document.getElementById("game-canvas");if(!O)throw new Error("Could not find game canvas element");const Q=new Z(O);Q.start();
//# sourceMappingURL=index-BtoBH5ed.js.map
